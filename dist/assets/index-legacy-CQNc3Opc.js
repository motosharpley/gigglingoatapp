System.register(["./index-legacy-l_Zrv-hC.js","./if-defined-legacy-CtbYZVez.js","./index-legacy-aclEvsjH.js","./index-legacy-7oYBEIjM.js"],(function(e,o){"use strict";var t,n,a,r,s,i,c,d,u,l,T,k,m,g,v,p,w,A,S,P,f,h,b,y,I,N;return{setters:[e=>{t=e.e,n=e.A,a=e.B,r=e.k,s=e.N,i=e.w,c=e.u,d=e.R,u=e.S,l=e.f,T=e.W,k=e.d,m=e.n,g=e.v,v=e.b,p=e.C,w=e.c,A=e.y,S=e.z,P=e.i,f=e.r,h=e.h,b=e.a,y=e.x},e=>{I=e.n,N=e.c},null,null],execute:function(){const o={async getTokenList(){var e;const o=t.state.activeCaipNetwork,n=await a.fetchSwapTokens({chainId:null==o?void 0:o.caipNetworkId});return(null==n||null===(e=n.tokens)||void 0===e?void 0:e.map((e=>({...e,eip2612:!1,quantity:{decimals:"0",numeric:"0"},price:0,value:0}))))||[]},async fetchGasPrice(){var e,o;const n=t.state.activeCaipNetwork;if(!n)return null;try{if("solana"===n.chainNamespace){const t=null===(e=await(null===(o=r)||void 0===o?void 0:o.estimateGas({chainNamespace:"solana"})))||void 0===e?void 0:e.toString();return{standard:t,fast:t,instant:t}}return await a.fetchGasPrice({chainId:n.caipNetworkId})}catch{return null}},async fetchSwapAllowance({tokenAddress:e,userAddress:o,sourceTokenAmount:t,sourceTokenDecimals:n}){const s=await a.fetchSwapAllowance({tokenAddress:e,userAddress:o});if(null!=s&&s.allowance&&t&&n){const e=r.parseUnits(t,n)||0;return BigInt(s.allowance)>=e}return!1},async getMyTokensWithBalance(e){const o=n.state.address,r=t.state.activeCaipNetwork;if(!o||!r)return[];const s=(await a.getBalance(o,r.caipNetworkId,e)).balances.filter((e=>"0"!==e.quantity.decimals));return n.setTokenBalance(s,t.state.activeChain),this.mapBalancesToSwapTokens(s)},mapBalancesToSwapTokens:e=>(null==e?void 0:e.map((e=>({...e,address:null!=e&&e.address?e.address:t.getActiveNetworkTokenAddress(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1}))))||[]},U={getGasPriceInEther:(e,o)=>Number(o*e)/1e18,getGasPriceInUSD(e,o,t){const n=U.getGasPriceInEther(o,t);return s.bigNumber(e).times(n).toNumber()},getPriceImpact({sourceTokenAmount:e,sourceTokenPriceInUSD:o,toTokenPriceInUSD:t,toTokenAmount:n}){const a=s.bigNumber(e).times(o),r=s.bigNumber(n).times(t);return a.minus(r).div(a).times(100).toNumber()},getMaxSlippage(e,o){const t=s.bigNumber(e).div(100);return s.multiply(o,t).toNumber()},getProviderFee:(e,o=.0085)=>s.bigNumber(e).times(o).toString(),isInsufficientNetworkTokenForGas(e,o){const t=o||"0";return!!s.bigNumber(e).eq(0)||s.bigNumber(s.bigNumber(t)).gt(e)},isInsufficientSourceTokenForSwap(e,o,t){var n;const a=null==t||null===(n=t.find((e=>e.address===o)))||void 0===n||null===(n=n.quantity)||void 0===n?void 0:n.numeric;return s.bigNumber(a||"0").lt(e)},getToTokenAmount({sourceToken:e,toToken:o,sourceTokenPrice:t,toTokenPrice:n,sourceTokenAmount:a}){if("0"===a)return"0";if(!e||!o)return"0";const r=e.decimals,i=t,c=o.decimals,d=n;if(d<=0)return"0";const u=s.bigNumber(a).times(.0085),l=s.bigNumber(a).minus(u).times(s.bigNumber(10).pow(r)),T=s.bigNumber(i).div(d),k=r-c;return l.times(T).div(s.bigNumber(10).pow(k)).div(s.bigNumber(10).pow(c)).toFixed(c).toString()}},E=15e4,B={initializing:!1,initialized:!1,loadingPrices:!1,loadingQuote:!1,loadingApprovalTransaction:!1,loadingBuildTransaction:!1,loadingTransaction:!1,fetchError:!1,approvalTransaction:void 0,swapTransaction:void 0,transactionError:void 0,sourceToken:void 0,sourceTokenAmount:"",sourceTokenPriceInUSD:0,toToken:void 0,toTokenAmount:"",toTokenPriceInUSD:0,networkPrice:"0",networkBalanceInUSD:"0",networkTokenSymbol:"",inputError:void 0,slippage:v.CONVERT_SLIPPAGE_TOLERANCE,tokens:void 0,popularTokens:void 0,suggestedTokens:void 0,foundTokens:void 0,myTokensWithBalance:void 0,tokensPriceMap:{},gasFee:"0",gasPriceInUSD:0,priceImpact:void 0,maxSlippage:void 0,providerFee:void 0},C=c(B),D={state:C,subscribe:e=>S(C,(()=>e(C))),subscribeKey:(e,o)=>A(C,e,o),getParams(){var e,o,n,a,r,i,c,d;const u=t.state.activeCaipAddress,l=t.state.activeChain,T=k.getPlainAddress(u),m=t.getActiveNetworkTokenAddress(),g=p.getConnectorId(l);if(!T)throw new Error("No address found to swap the tokens from.");const v=!(null!==(e=C.toToken)&&void 0!==e&&e.address&&null!==(o=C.toToken)&&void 0!==o&&o.decimals),A=!(null!==(n=C.sourceToken)&&void 0!==n&&n.address&&null!==(a=C.sourceToken)&&void 0!==a&&a.decimals&&s.bigNumber(C.sourceTokenAmount).gt(0)),S=!C.sourceTokenAmount;return{networkAddress:m,fromAddress:T,fromCaipAddress:u,sourceTokenAddress:null===(r=C.sourceToken)||void 0===r?void 0:r.address,toTokenAddress:null===(i=C.toToken)||void 0===i?void 0:i.address,toTokenAmount:C.toTokenAmount,toTokenDecimals:null===(c=C.toToken)||void 0===c?void 0:c.decimals,sourceTokenAmount:C.sourceTokenAmount,sourceTokenDecimals:null===(d=C.sourceToken)||void 0===d?void 0:d.decimals,invalidToToken:v,invalidSourceToken:A,invalidSourceTokenAmount:S,availableToSwap:u&&!v&&!A&&!S,isAuthConnector:g===w.CONNECTOR_ID.AUTH}},setSourceToken(e){if(!e)return C.sourceToken=e,C.sourceTokenAmount="",void(C.sourceTokenPriceInUSD=0);C.sourceToken=e,x.setTokenPrice(e.address,"sourceToken")},setSourceTokenAmount(e){C.sourceTokenAmount=e},setToToken(e){if(!e)return C.toToken=e,C.toTokenAmount="",void(C.toTokenPriceInUSD=0);C.toToken=e,x.setTokenPrice(e.address,"toToken")},setToTokenAmount(e){C.toTokenAmount=e?s.formatNumberToLocalString(e,6):""},async setTokenPrice(e,o){let t=C.tokensPriceMap[e]||0;t||(C.loadingPrices=!0,t=await x.getAddressPrice(e)),"sourceToken"===o?C.sourceTokenPriceInUSD=t:"toToken"===o&&(C.toTokenPriceInUSD=t),C.loadingPrices&&(C.loadingPrices=!1),x.getParams().availableToSwap&&x.swapTokens()},switchTokens(){if(C.initializing||!C.initialized)return;const e=C.toToken?{...C.toToken}:void 0,o=C.sourceToken?{...C.sourceToken}:void 0,t=e&&""===C.toTokenAmount?"1":C.toTokenAmount;x.setSourceToken(e),x.setToToken(o),x.setSourceTokenAmount(t),x.setToTokenAmount(""),x.swapTokens()},resetState(){C.myTokensWithBalance=B.myTokensWithBalance,C.tokensPriceMap=B.tokensPriceMap,C.initialized=B.initialized,C.sourceToken=B.sourceToken,C.sourceTokenAmount=B.sourceTokenAmount,C.sourceTokenPriceInUSD=B.sourceTokenPriceInUSD,C.toToken=B.toToken,C.toTokenAmount=B.toTokenAmount,C.toTokenPriceInUSD=B.toTokenPriceInUSD,C.networkPrice=B.networkPrice,C.networkTokenSymbol=B.networkTokenSymbol,C.networkBalanceInUSD=B.networkBalanceInUSD,C.inputError=B.inputError,C.myTokensWithBalance=B.myTokensWithBalance},resetValues(){var e;const{networkAddress:o}=x.getParams(),t=null===(e=C.tokens)||void 0===e?void 0:e.find((e=>e.address===o));x.setSourceToken(t),x.setToToken(void 0)},getApprovalLoadingState:()=>C.loadingApprovalTransaction,clearError(){C.transactionError=void 0},async initializeState(){if(!C.initializing){if(C.initializing=!0,!C.initialized)try{await x.fetchTokens(),C.initialized=!0}catch(e){C.initialized=!1,u.showError("Failed to initialize swap"),d.goBack()}C.initializing=!1}},async fetchTokens(){var e;const{networkAddress:o}=x.getParams();await x.getTokenList(),await x.getNetworkTokenPrice(),await x.getMyTokensWithBalance();const t=null===(e=C.tokens)||void 0===e?void 0:e.find((e=>e.address===o));t&&(C.networkTokenSymbol=t.symbol,x.setSourceToken(t),x.setSourceTokenAmount("1"))},async getTokenList(){const e=await o.getTokenList();C.tokens=e,C.popularTokens=e.sort(((e,o)=>e.symbol<o.symbol?-1:e.symbol>o.symbol?1:0)),C.suggestedTokens=e.filter((e=>!!v.SWAP_SUGGESTED_TOKENS.includes(e.symbol)),{})},async getAddressPrice(e){var o,t;const n=C.tokensPriceMap[e];if(n)return n;const r=await a.fetchTokenPrice({addresses:[e]}),s=(null==r?void 0:r.fungibles)||[],i=[...C.tokens||[],...C.myTokensWithBalance||[]],c=null==i||null===(o=i.find((o=>o.address===e)))||void 0===o?void 0:o.symbol,d=(null===(t=s.find((e=>e.symbol.toLowerCase()===(null==c?void 0:c.toLowerCase()))))||void 0===t?void 0:t.price)||0,u=parseFloat(d.toString());return C.tokensPriceMap[e]=u,u},async getNetworkTokenPrice(){var e;const{networkAddress:o}=x.getParams(),t=null===(e=(await a.fetchTokenPrice({addresses:[o]}).catch((()=>(u.showError("Failed to fetch network token price"),{fungibles:[]})))).fungibles)||void 0===e?void 0:e[0],n=(null==t?void 0:t.price.toString())||"0";C.tokensPriceMap[o]=parseFloat(n),C.networkTokenSymbol=(null==t?void 0:t.symbol)||"",C.networkPrice=n},async getMyTokensWithBalance(e){const o=await g.getMyTokensWithBalance(e),t=g.mapBalancesToSwapTokens(o);t&&(await x.getInitialGasPrice(),x.setBalances(t))},setBalances(e){const{networkAddress:o}=x.getParams(),n=t.state.activeCaipNetwork;if(!n)return;const a=e.find((e=>e.address===o));e.forEach((e=>{C.tokensPriceMap[e.address]=e.price||0})),C.myTokensWithBalance=e.filter((e=>e.address.startsWith(n.caipNetworkId))),C.networkBalanceInUSD=a?s.multiply(a.quantity.numeric,a.price).toString():"0"},async getInitialGasPrice(){var e,n,a;const r=await o.fetchGasPrice();if(!r)return{gasPrice:null,gasPriceInUSD:null};if("solana"===(null===(e=t.state)||void 0===e||null===(e=e.activeCaipNetwork)||void 0===e?void 0:e.chainNamespace))return C.gasFee=null!==(n=r.standard)&&void 0!==n?n:"0",C.gasPriceInUSD=s.multiply(r.standard,C.networkPrice).div(1e9).toNumber(),{gasPrice:BigInt(C.gasFee),gasPriceInUSD:Number(C.gasPriceInUSD)};{const e=null!==(a=r.standard)&&void 0!==a?a:"0",o=BigInt(e),t=BigInt(E),n=U.getGasPriceInUSD(C.networkPrice,t,o);return C.gasFee=e,C.gasPriceInUSD=n,{gasPrice:o,gasPriceInUSD:n}}},async swapTokens(){const e=n.state.address,o=C.sourceToken,t=C.toToken,r=s.bigNumber(C.sourceTokenAmount).gt(0);if(r||x.setToTokenAmount(""),!t||!o||C.loadingPrices||!r)return;C.loadingQuote=!0;const i=s.bigNumber(C.sourceTokenAmount).times(10**o.decimals).round(0);try{var c;const n=await a.fetchSwapQuote({userAddress:e,from:o.address,to:t.address,gasPrice:C.gasFee,amount:i.toString()});C.loadingQuote=!1;const r=null==n||null===(c=n.quotes)||void 0===c||null===(c=c[0])||void 0===c?void 0:c.toAmount;if(!r)return void m.open({shortMessage:"Incorrect amount",longMessage:"Please enter a valid amount"},"error");const d=s.bigNumber(r).div(10**t.decimals).toString();x.setToTokenAmount(d),x.hasInsufficientToken(C.sourceTokenAmount,o.address)?C.inputError="Insufficient balance":(C.inputError=void 0,x.setTransactionDetails())}catch(d){C.loadingQuote=!1,C.inputError="Insufficient balance"}},async getTransaction(){const{fromCaipAddress:e,availableToSwap:t}=x.getParams(),n=C.sourceToken,a=C.toToken;if(e&&t&&n&&a&&!C.loadingQuote)try{let t;return C.loadingBuildTransaction=!0,t=await o.fetchSwapAllowance({userAddress:e,tokenAddress:n.address,sourceTokenAmount:C.sourceTokenAmount,sourceTokenDecimals:n.decimals})?await x.createSwapTransaction():await x.createAllowanceTransaction(),C.loadingBuildTransaction=!1,C.fetchError=!1,t}catch(r){return d.goBack(),u.showError("Failed to check allowance"),C.loadingBuildTransaction=!1,C.approvalTransaction=void 0,C.swapTransaction=void 0,void(C.fetchError=!0)}},async createAllowanceTransaction(){const{fromCaipAddress:e,sourceTokenAddress:o,toTokenAddress:t}=x.getParams();if(e&&t){if(!o)throw new Error("createAllowanceTransaction - No source token address found.");try{const n=await a.generateApproveCalldata({from:o,to:t,userAddress:e}),r={data:n.tx.data,to:k.getPlainAddress(n.tx.from),gasPrice:BigInt(n.tx.eip155.gasPrice),value:BigInt(n.tx.value),toAmount:C.toTokenAmount};return C.swapTransaction=void 0,C.approvalTransaction={data:r.data,to:r.to,gasPrice:r.gasPrice,value:r.value,toAmount:r.toAmount},{data:r.data,to:r.to,gasPrice:r.gasPrice,value:r.value,toAmount:r.toAmount}}catch(n){return d.goBack(),u.showError("Failed to create approval transaction"),C.approvalTransaction=void 0,C.swapTransaction=void 0,void(C.fetchError=!0)}}},async createSwapTransaction(){var e;const{networkAddress:o,fromCaipAddress:t,sourceTokenAmount:n}=x.getParams(),s=C.sourceToken,i=C.toToken;if(!(t&&n&&s&&i))return;const c=null===(e=r.parseUnits(n,s.decimals))||void 0===e?void 0:e.toString();try{const e=await a.generateSwapCalldata({userAddress:t,from:s.address,to:i.address,amount:c,disableEstimate:!0}),n=s.address===o,r=BigInt(e.tx.eip155.gas),d=BigInt(e.tx.eip155.gasPrice),u={data:e.tx.data,to:k.getPlainAddress(e.tx.to),gas:r,gasPrice:d,value:n?BigInt(null!=c?c:"0"):BigInt("0"),toAmount:C.toTokenAmount};return C.gasPriceInUSD=U.getGasPriceInUSD(C.networkPrice,r,d),C.approvalTransaction=void 0,C.swapTransaction=u,u}catch(l){return d.goBack(),u.showError("Failed to create transaction"),C.approvalTransaction=void 0,C.swapTransaction=void 0,void(C.fetchError=!0)}},async sendTransactionForApproval(e){const{fromAddress:o,isAuthConnector:a}=x.getParams();C.loadingApprovalTransaction=!0;const s="Approve limit increase in your wallet";a?d.pushTransactionStack({onSuccess(){u.showLoading(s)}}):u.showLoading(s);try{await r.sendTransaction({address:o,to:e.to,data:e.data,value:e.value,chainNamespace:"eip155"}),await x.swapTokens(),await x.getTransaction(),C.approvalTransaction=void 0,C.loadingApprovalTransaction=!1}catch(g){var i,c,k,m;const e=g;C.transactionError=null==e?void 0:e.shortMessage,C.loadingApprovalTransaction=!1,u.showError((null==e?void 0:e.shortMessage)||"Transaction error"),l.sendEvent({type:"track",event:"SWAP_APPROVAL_ERROR",properties:{message:(null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||"Unknown",network:(null===(i=t.state.activeCaipNetwork)||void 0===i?void 0:i.caipNetworkId)||"",swapFromToken:(null===(c=x.state.sourceToken)||void 0===c?void 0:c.symbol)||"",swapToToken:(null===(k=x.state.toToken)||void 0===k?void 0:k.symbol)||"",swapFromAmount:x.state.sourceTokenAmount||"",swapToAmount:x.state.toTokenAmount||"",isSmartAccount:(null===(m=n.state.preferredAccountTypes)||void 0===m?void 0:m.eip155)===T.ACCOUNT_TYPES.SMART_ACCOUNT}})}},async sendTransactionForSwap(e){var o,a,i,c;if(!e)return;const{fromAddress:k,toTokenAmount:m,isAuthConnector:g}=x.getParams();C.loadingTransaction=!0;const v=`Swapping ${null===(o=C.sourceToken)||void 0===o?void 0:o.symbol} to ${s.formatNumberToLocalString(m,3)} ${null===(a=C.toToken)||void 0===a?void 0:a.symbol}`,p=`Swapped ${null===(i=C.sourceToken)||void 0===i?void 0:i.symbol} to ${s.formatNumberToLocalString(m,3)} ${null===(c=C.toToken)||void 0===c?void 0:c.symbol}`;g?d.pushTransactionStack({onSuccess(){d.replace("Account"),u.showLoading(v),D.resetState()}}):u.showLoading("Confirm transaction in your wallet");try{var w,A,S,P,f,h;const o=[null===(w=C.sourceToken)||void 0===w?void 0:w.address,null===(A=C.toToken)||void 0===A?void 0:A.address].join(","),a=await r.sendTransaction({address:k,to:e.to,data:e.data,value:e.value,chainNamespace:"eip155"});return C.loadingTransaction=!1,u.showSuccess(p),l.sendEvent({type:"track",event:"SWAP_SUCCESS",properties:{network:(null===(S=t.state.activeCaipNetwork)||void 0===S?void 0:S.caipNetworkId)||"",swapFromToken:(null===(P=x.state.sourceToken)||void 0===P?void 0:P.symbol)||"",swapToToken:(null===(f=x.state.toToken)||void 0===f?void 0:f.symbol)||"",swapFromAmount:x.state.sourceTokenAmount||"",swapToAmount:x.state.toTokenAmount||"",isSmartAccount:(null===(h=n.state.preferredAccountTypes)||void 0===h?void 0:h.eip155)===T.ACCOUNT_TYPES.SMART_ACCOUNT}}),D.resetState(),g||d.replace("Account"),D.getMyTokensWithBalance(o),a}catch(U){var b,y,I,N;const e=U;return C.transactionError=null==e?void 0:e.shortMessage,C.loadingTransaction=!1,u.showError((null==e?void 0:e.shortMessage)||"Transaction error"),void l.sendEvent({type:"track",event:"SWAP_ERROR",properties:{message:(null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||"Unknown",network:(null===(b=t.state.activeCaipNetwork)||void 0===b?void 0:b.caipNetworkId)||"",swapFromToken:(null===(y=x.state.sourceToken)||void 0===y?void 0:y.symbol)||"",swapToToken:(null===(I=x.state.toToken)||void 0===I?void 0:I.symbol)||"",swapFromAmount:x.state.sourceTokenAmount||"",swapToAmount:x.state.toTokenAmount||"",isSmartAccount:(null===(N=n.state.preferredAccountTypes)||void 0===N?void 0:N.eip155)===T.ACCOUNT_TYPES.SMART_ACCOUNT}})}},hasInsufficientToken:(e,o)=>U.isInsufficientSourceTokenForSwap(e,o,C.myTokensWithBalance),setTransactionDetails(){const{toTokenAddress:e,toTokenDecimals:o}=x.getParams();e&&o&&(C.gasPriceInUSD=U.getGasPriceInUSD(C.networkPrice,BigInt(C.gasFee),BigInt(E)),C.priceImpact=U.getPriceImpact({sourceTokenAmount:C.sourceTokenAmount,sourceTokenPriceInUSD:C.sourceTokenPriceInUSD,toTokenPriceInUSD:C.toTokenPriceInUSD,toTokenAmount:C.toTokenAmount}),C.maxSlippage=U.getMaxSlippage(C.slippage,C.toTokenAmount),C.providerFee=U.getProviderFee(C.sourceTokenAmount))}},x=e("S",i(D)),F=P`
  :host {
    display: block;
  }

  :host > button {
    gap: var(--wui-spacing-xxs);
    padding: var(--wui-spacing-xs);
    padding-right: var(--wui-spacing-1xs);
    height: 40px;
    border-radius: var(--wui-border-radius-l);
    background: var(--wui-color-gray-glass-002);
    border-width: 0px;
    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-002);
  }

  :host > button wui-image {
    width: 24px;
    height: 24px;
    border-radius: var(--wui-border-radius-s);
    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-010);
  }
`;var M=function(e,o,t,n){var a,r=arguments.length,s=r<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,o,t,n);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(r<3?a(s):r>3?a(o,t,s):a(o,t))||s);return r>3&&s&&Object.defineProperty(o,t,s),s};let W=class extends b{constructor(){super(...arguments),this.text=""}render(){return y`
      <button>
        ${this.tokenTemplate()}
        <wui-text variant="paragraph-600" color="fg-100">${this.text}</wui-text>
      </button>
    `}tokenTemplate(){return this.imageSrc?y`<wui-image src=${this.imageSrc}></wui-image>`:y`
      <wui-icon-box
        size="sm"
        iconColor="fg-200"
        backgroundColor="fg-300"
        icon="networkPlaceholder"
      ></wui-icon-box>
    `}};W.styles=[f,h,F],M([I()],W.prototype,"imageSrc",void 0),M([I()],W.prototype,"text",void 0),W=M([N("wui-token-button")],W)}}}));
